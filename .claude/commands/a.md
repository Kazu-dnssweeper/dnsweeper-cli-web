# コードベース分析と改善点発見

現在のコードベースを包括的に分析し、改善点を特定してタスクを生成します。

## 🤖 Claude API統合（NEW - 2025-07-15更新）

### 使用方法
```bash
# 基本の静的分析のみ（API不使用）
/a

# AI統合分析（3つの分析を一度に実行）👈 推奨
/a --with-ai
```

### AI統合分析の内容

`/a --with-ai`を実行すると、以下の3つの分析が**全て自動的に実行**されます：

#### 1. 🏗️ アーキテクチャ分析
- 現在の品質スコア（7.2/10）から8.5/10への具体的な改善計画
- 技術的負債の優先順位付け
- ベストプラクティスとの差分分析
- 1週間・1ヶ月・3ヶ月の段階的改善計画

#### 2. 🔧 リファクタリング提案
- 大きなファイル5個（1,000行超）の具体的な分割方法
- any型（108箇所）を具体的な型に置き換える提案
- 重複コードの統合方法
- 各リファクタリングの推定作業時間

#### 3. 🧪 テスト生成戦略
- カバレッジ向上計画（60%→85%）
- 未テストファイルの具体的なテストケース例
- E2Eテストシナリオ（主要5フロー）
- モック・スタブ戦略

### 実行結果
- 📄 **統合レポート生成**: `.claude/ai-analysis-report.md`
- 🔗 **`/e`との自動連携**: 分析結果が次回の`/e`実行時の優先タスクに
- 📊 **実行可能な提案**: 具体的なコード例とステップバイステップガイド

### コスト
- **統合分析（全3分析）**: 約$0.125/回
- **推奨頻度**: 週1回
- **月額コスト**: 約$0.50（週1回実行の場合）

### 注意事項
- オプションフラグ（`--refactor`、`--test-generation`）は廃止
- `--with-ai`で常に3つの分析を統合実行
- より包括的で実用的な提案を一度に取得

## 1. コードベース全体の分析

### 構造分析
- ファイル・ディレクトリ構造の確認
- 依存関係の分析
- アーキテクチャパターンの評価
- モジュール間の結合度チェック

### 品質分析
- ESLint/TypeScriptエラーの検出
- コードの複雑度測定
- 重複コードの特定
- 命名規則の一貫性チェック

### パフォーマンス分析
- パフォーマンスボトルネックの特定
- メモリ使用量の分析
- 非効率なアルゴリズムの検出
- ビルド時間の測定

## 2. テストカバレッジ分析
- 現在のテストカバレッジ測定
- 未テストコードの特定
- テストの品質評価
- モックとスタブの適切性確認

## 3. セキュリティ分析
- 脆弱性の検出（npm audit）
- セキュリティベストプラクティスのチェック
- 機密情報の漏洩リスク評価
- 依存関係のセキュリティチェック

## 4. ドキュメント分析
- ドキュメントの完成度評価
- APIドキュメントの自動生成可能性
- コード内コメントの品質チェック
- README・ガイドの更新必要性

## 5. 改善タスクの生成
分析結果に基づいて以下を生成：

### 緊急度：高
- セキュリティ脆弱性の修正
- ビルドエラーの解決
- 重要な機能のバグ修正

### 緊急度：中
- テストカバレッジの向上
- パフォーマンスの最適化
- コードの品質改善

### 緊急度：低
- ドキュメントの整備
- コードの重複削除
- 命名の一貫性確保

## 6. 出力フォーマット
分析結果を`.claude/auto-task-system.md`に追加：

```markdown
## 📈 コードベース分析結果 (2025-07-13)

### 品質スコア: 7.5/10
- コード品質: 8/10
- テストカバレッジ: 0/10 (要改善)
- セキュリティ: 9/10
- ドキュメント: 7/10

### 発見された改善点
1. **テストスイートの構築** [緊急度: 高]
   - 単体テストの作成
   - 統合テストの実装
   - E2Eテストの設計

2. **パフォーマンス最適化** [緊急度: 中]
   - 非同期処理の改善
   - メモリ使用量の削減

### 生成されたタスク
- [ ] Jest環境構築とテスト作成
- [ ] ESLintルール強化
- [ ] API仕様書作成
```

## 🔄 実行フロー（Claude API統合時）

1. **静的分析の実行**
   ```bash
   # TypeScript/ESLintエラー収集
   npx tsc --noEmit
   npx eslint src --format json
   ```

2. **Claude APIでの分析**
   ```bash
   # Pythonスクリプト実行
   python3 scripts/analyze_with_claude.py --with-ai
   ```

3. **レポート生成**
   - `.claude/ai-analysis-report.md`に結果保存
   - 優先順位付きタスクリスト
   - 実装可能な具体的提案

## 実行後のアクション
1. `.claude/auto-task-system.md`を更新
2. 最も重要なタスクを次のタスクキューに追加
3. マイルストーンとの整合性確認
4. 改善の進捗を追跡する仕組みを構築