# competitive-advantages-service.ts 分割計画

## 📊 現状分析
- **現在の行数**: 2,579行
- **問題点**: 単一責任原則違反、巨大クラス、保守性低下
- **影響**: 開発効率低下、テスト困難、デバッグ難易度上昇

## 🎯 分割戦略

### 1. CompetitiveAnalysisCore.ts (500-600行)
**責任**: 競争分析の核心ロジック
- `CompetitiveAnalysis` 型の処理
- 市場分析アルゴリズム
- 競合他社データ管理
- 競争優位性の計算ロジック

**含まれるメソッド**:
- `performCompetitiveAnalysis()`
- `buildCompetitiveAdvantages()`
- `calculateInnovationMetrics()`

### 2. MarketPositioningService.ts (400-500行)
**責任**: 市場ポジショニングと戦略
- 市場分析機能
- ポジショニング戦略
- 競合比較分析
- 市場シェア計算

**含まれるメソッド**:
- 市場分析関連の全メソッド
- ポジショニング計算
- 競合比較ロジック

### 3. CompetitorTrackingService.ts (400-500行)
**責任**: 競合他社の追跡と監視
- 競合他社データ管理
- 動向分析
- 脅威評価
- 機会分析

**含まれるメソッド**:
- 競合他社追跡機能
- 動向分析アルゴリズム
- 脅威・機会評価

### 4. AdvantageMetricsService.ts (400-500行)
**責任**: 競争優位性指標の計算と管理
- `InnovationMetrics` 処理
- KPI計算
- パフォーマンス指標
- ROI分析

**含まれるメソッド**:
- `calculateInnovationMetrics()`
- 各種指標計算メソッド
- メトリクス集計ロジック

### 5. ReportGenerationService.ts (400-500行)
**責任**: レポート生成とダッシュボード
- `CompetitiveAdvantageDashboard` 生成
- レポート作成
- データ可視化
- エクスポート機能

**含まれるメソッド**:
- レポート生成関連メソッド
- ダッシュボード作成
- データ出力機能

## 🔧 実装計画

### フェーズ1: 基盤の準備
1. **共通インターフェース定義**
   - 各サービス間の依存関係を明確化
   - 共通の型定義を`types/competitive-advantages/`に整理
   - 依存性注入パターンの導入

2. **テストファーストアプローチ**
   - 現在のAPIを維持するテストケース作成
   - 分割後の各サービスのテスト設計
   - リグレッションテストの準備

### フェーズ2: 段階的分割
1. **CompetitiveAnalysisCore.ts** (最優先)
   - 核心ロジックを抽出
   - 他のサービスから独立した部分から開始
   
2. **MarketPositioningService.ts**
   - 市場分析機能を分離
   - CoreServiceとの結合部分を設計
   
3. **残りのサービス**
   - CompetitorTrackingService.ts
   - AdvantageMetricsService.ts
   - ReportGenerationService.ts

### フェーズ3: 統合とテスト
1. **メインサービスの再設計**
   - `CompetitiveAdvantagesService` を軽量なコーディネーターに変更
   - 依存関係の整理
   - パフォーマンス最適化

2. **総合テスト**
   - 機能テスト
   - パフォーマンステスト
   - 統合テスト

## 📋 次のアクション

### 今すぐ実行できるタスク
1. **コード分析の詳細化**
   - 各セクションの詳細な依存関係マップ作成
   - 移動対象メソッドの一覧作成
   - 共通ユーティリティの特定

2. **テストケース作成**
   - 現在のAPIの振る舞いを保証するテスト
   - 分割後のサービス用テストスケルトン

3. **型定義の整理**
   - 共通型と各サービス固有型の分離
   - インターフェースの明確化

### 実装優先度
1. **🔴 最優先**: CompetitiveAnalysisCore.ts の抽出
2. **🟡 高**: MarketPositioningService.ts の実装
3. **🟢 中**: 残りのサービスの段階的実装

## 🎯 成功指標
- ファイル行数: 各ファイル500行以下
- テストカバレッジ: 85%以上維持
- パフォーマンス: 既存機能と同等以上
- 保守性: サイクロマティック複雑度20以下

## ⚠️ リスク要因
- **データ依存関係**: 複雑な内部状態の分割
- **パフォーマンス**: サービス間通信のオーバーヘッド
- **テスト**: 既存機能の振る舞い保証

## 📅 スケジュール
- **フェーズ1**: 1-2時間（準備）
- **フェーズ2**: 4-6時間（実装）
- **フェーズ3**: 2-3時間（統合・テスト）
- **合計**: 7-11時間の作業時間