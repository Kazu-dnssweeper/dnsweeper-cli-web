/**
 * DNS ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æãƒšãƒ¼ã‚¸
 */

import React, { useState, useEffect } from 'react';
import {
  Container,
  Typography,
  Box,
  Grid,
  Card,
  CardContent,
  Button,
  TextField,
  Select,
  MenuItem,
  FormControl,
  InputLabel,
  Chip,
  Alert,
  CircularProgress,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Badge,
  Avatar,
  List,
  ListItem,
  ListItemText,
  ListItemAvatar,
  IconButton,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Paper,
  Tabs,
  Tab,
  Switch,
  FormControlLabel,
  LinearProgress,
  Tooltip,
  Divider
} from '@mui/material';
import {
  ExpandMore as ExpandMoreIcon,
  Security as SecurityIcon,
  Warning as WarningIcon,
  Shield as ShieldIcon,
  BugReport as BugReportIcon,
  Phishing as PhishingIcon,
  Computer as ComputerIcon,
  Speed as SpeedIcon,
  Lock as LockIcon,
  Link as LinkIcon,
  Refresh as RefreshIcon,
  PlayArrow as PlayArrowIcon,
  Stop as StopIcon,
  Download as DownloadIcon,
  Visibility as VisibilityIcon,
  Report as ReportIcon,
  Timeline as TimelineIcon,
  Dashboard as DashboardIcon,
  FilterList as FilterListIcon,
  Search as SearchIcon
} from '@mui/icons-material';
import { useAuth } from '../contexts/AuthContext';\nimport { LoadingSpinner } from '../components/LoadingSpinner';\nimport { ErrorAlert } from '../components/ErrorAlert';\n\ninterface SecurityThreat {\n  id: string;\n  type: 'malware' | 'phishing' | 'typosquatting' | 'dga' | 'fastflux' | 'dns_hijacking' | 'cache_poisoning' | 'subdomain_takeover';\n  severity: 'critical' | 'high' | 'medium' | 'low';\n  confidence: number;\n  domain: string;\n  timestamp: number;\n  description: string;\n  indicators: {\n    technicalIndicators: string[];\n    behavioralIndicators: string[];\n    reputationIndicators: string[];\n  };\n  mitigation: {\n    immediateActions: string[];\n    longTermActions: string[];\n    preventionMeasures: string[];\n  };\n  evidence: {\n    dnsRecords: any[];\n    networkAnalysis: {\n      ipReputationScore: number;\n      geoLocationRisk: number;\n      domainAge: number;\n      certificateStatus: string;\n    };\n  };\n}\n\ninterface SecurityAnalysisResults {\n  threats: SecurityThreat[];\n  statistics: {\n    totalThreats: number;\n    threatsByType: Record<string, number>;\n    threatsBySeverity: Record<string, number>;\n  };\n  analysisTime: number;\n}\n\nconst SecurityAnalysis: React.FC = () => {\n  const { user } = useAuth();\n  const [domains, setDomains] = useState<string>('');\n  const [analysisResults, setAnalysisResults] = useState<SecurityAnalysisResults | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedThreat, setSelectedThreat] = useState<SecurityThreat | null>(null);\n  const [realTimeMonitoring, setRealTimeMonitoring] = useState(false);\n  const [severityFilter, setSeverityFilter] = useState<string>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n  const [confidenceThreshold, setConfidenceThreshold] = useState<number>(70);\n  const [activeTab, setActiveTab] = useState(0);\n  const [monitoringInterval, setMonitoringInterval] = useState<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    return () => {\n      if (monitoringInterval) {\n        clearInterval(monitoringInterval);\n      }\n    };\n  }, [monitoringInterval]);\n\n  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æã®å®Ÿè¡Œ\n  const runSecurityAnalysis = async () => {\n    if (!domains.trim()) {\n      setError('ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const startTime = Date.now();\n      \n      // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æAPIã‚’å‘¼ã³å‡ºã™\n      const mockThreats: SecurityThreat[] = [\n        {\n          id: 'threat-1',\n          type: 'malware',\n          severity: 'critical',\n          confidence: 95,\n          domain: 'malicious-example.com',\n          timestamp: Date.now(),\n          description: 'ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯æ—¢çŸ¥ã®ãƒãƒ«ã‚¦ã‚§ã‚¢é…å¸ƒã‚µã‚¤ãƒˆã§ã™',\n          indicators: {\n            technicalIndicators: ['æ—¢çŸ¥ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³', 'å¤šæ•°ã®æ‚ªæ„ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«'],\n            behavioralIndicators: ['çŸ­æœŸé–“ã§ã®å¤§é‡ã‚¢ã‚¯ã‚»ã‚¹', 'ç•°å¸¸ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³'],\n            reputationIndicators: ['è¤‡æ•°ã®ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«ç™»éŒ²', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ãƒ³ãƒ€ãƒ¼ã«ã‚ˆã‚‹æ¤œå‡º']\n          },\n          mitigation: {\n            immediateActions: ['ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹é®æ–­', 'é–¢é€£IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ–ãƒ­ãƒƒã‚¯'],\n            longTermActions: ['ç¶™ç¶šçš„ãªç›£è¦–', 'ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œè¨ˆç”»ã®å®Ÿè¡Œ'],\n            preventionMeasures: ['DNSãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¼·åŒ–', 'å¾“æ¥­å“¡æ•™è‚²']\n          },\n          evidence: {\n            dnsRecords: [],\n            networkAnalysis: {\n              ipReputationScore: 15,\n              geoLocationRisk: 85,\n              domainAge: 30,\n              certificateStatus: 'invalid'\n            }\n          }\n        },\n        {\n          id: 'threat-2',\n          type: 'phishing',\n          severity: 'high',\n          confidence: 88,\n          domain: 'paypa1-security.com',\n          timestamp: Date.now() - 3600000,\n          description: 'PayPalã‚’æ¨¡å€£ã—ãŸãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚µã‚¤ãƒˆã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™',\n          indicators: {\n            technicalIndicators: ['ãƒ–ãƒ©ãƒ³ãƒ‰åã®é¡ä¼¼æ€§', 'å½è£…ã•ã‚ŒãŸSSLè¨¼æ˜æ›¸'],\n            behavioralIndicators: ['èªè¨¼æƒ…å ±ã®åé›†', 'é‡‘èã‚µãƒ¼ãƒ“ã‚¹ã®å½è£…'],\n            reputationIndicators: ['æ–°è¦ç™»éŒ²ãƒ‰ãƒ¡ã‚¤ãƒ³', 'ä¸å¯©ãªãƒ¡ãƒ¼ãƒ«é…ä¿¡']\n          },\n          mitigation: {\n            immediateActions: ['ãƒ¦ãƒ¼ã‚¶ãƒ¼è­¦å‘Šã®å®Ÿæ–½', 'ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å ±å‘Š'],\n            longTermActions: ['ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°å¯¾ç­–å¼·åŒ–', 'ç›£è¦–ç¶™ç¶š'],\n            preventionMeasures: ['ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•™è‚²']\n          },\n          evidence: {\n            dnsRecords: [],\n            networkAnalysis: {\n              ipReputationScore: 25,\n              geoLocationRisk: 70,\n              domainAge: 7,\n              certificateStatus: 'self_signed'\n            }\n          }\n        }\n      ];\n\n      const analysisTime = Date.now() - startTime;\n      \n      const results: SecurityAnalysisResults = {\n        threats: mockThreats,\n        statistics: {\n          totalThreats: mockThreats.length,\n          threatsByType: mockThreats.reduce((acc, threat) => {\n            acc[threat.type] = (acc[threat.type] || 0) + 1;\n            return acc;\n          }, {} as Record<string, number>),\n          threatsBySeverity: mockThreats.reduce((acc, threat) => {\n            acc[threat.severity] = (acc[threat.severity] || 0) + 1;\n            return acc;\n          }, {} as Record<string, number>)\n        },\n        analysisTime\n      };\n\n      setAnalysisResults(results);\n\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã®é–‹å§‹/åœæ­¢\n  const toggleRealTimeMonitoring = () => {\n    if (realTimeMonitoring) {\n      if (monitoringInterval) {\n        clearInterval(monitoringInterval);\n        setMonitoringInterval(null);\n      }\n      setRealTimeMonitoring(false);\n    } else {\n      const interval = setInterval(() => {\n        runSecurityAnalysis();\n      }, 60000); // 1åˆ†é–“éš”\n      setMonitoringInterval(interval);\n      setRealTimeMonitoring(true);\n    }\n  };\n\n  // è„…å¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n  const filteredThreats = analysisResults?.threats.filter(threat => {\n    if (severityFilter !== 'all' && threat.severity !== severityFilter) return false;\n    if (typeFilter !== 'all' && threat.type !== typeFilter) return false;\n    if (threat.confidence < confidenceThreshold) return false;\n    return true;\n  }) || [];\n\n  // è„…å¨ã‚¿ã‚¤ãƒ—ã®ã‚¢ã‚¤ã‚³ãƒ³\n  const getThreatIcon = (type: string) => {\n    switch (type) {\n      case 'malware': return <BugReportIcon />;\n      case 'phishing': return <PhishingIcon />;\n      case 'typosquatting': return <ComputerIcon />;\n      case 'dga': return <ComputerIcon />;\n      case 'fastflux': return <SpeedIcon />;\n      case 'dns_hijacking': return <LockIcon />;\n      case 'cache_poisoning': return <WarningIcon />;\n      case 'subdomain_takeover': return <LinkIcon />;\n      default: return <WarningIcon />;\n    }\n  };\n\n  // é‡è¦åº¦ã®è‰²\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical': return 'error';\n      case 'high': return 'warning';\n      case 'medium': return 'info';\n      case 'low': return 'success';\n      default: return 'default';\n    }\n  };\n\n  // è„…å¨çµ±è¨ˆã®å¯è¦–åŒ–\n  const renderThreatStatistics = () => {\n    if (!analysisResults) return null;\n\n    return (\n      <Grid container spacing={2} sx={{ mb: 3 }}>\n        <Grid item xs={6} md={3}>\n          <Card>\n            <CardContent sx={{ textAlign: 'center' }}>\n              <Typography variant=\"h4\" color=\"primary\">\n                {analysisResults.statistics.totalThreats}\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                ç·è„…å¨æ•°\n              </Typography>\n            </CardContent>\n          </Card>\n        </Grid>\n        \n        <Grid item xs={6} md={3}>\n          <Card>\n            <CardContent sx={{ textAlign: 'center' }}>\n              <Typography variant=\"h4\" color=\"error\">\n                {analysisResults.statistics.threatsBySeverity.critical || 0}\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                é‡è¦è„…å¨\n              </Typography>\n            </CardContent>\n          </Card>\n        </Grid>\n        \n        <Grid item xs={6} md={3}>\n          <Card>\n            <CardContent sx={{ textAlign: 'center' }}>\n              <Typography variant=\"h4\" color=\"warning\">\n                {analysisResults.statistics.threatsBySeverity.high || 0}\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                é«˜è„…å¨\n              </Typography>\n            </CardContent>\n          </Card>\n        </Grid>\n        \n        <Grid item xs={6} md={3}>\n          <Card>\n            <CardContent sx={{ textAlign: 'center' }}>\n              <Typography variant=\"h4\" color=\"info\">\n                {(analysisResults.analysisTime / 1000).toFixed(1)}s\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                åˆ†ææ™‚é–“\n              </Typography>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n    );\n  };\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ py: 4 }}>\n      <Typography variant=\"h4\" gutterBottom sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n        <SecurityIcon color=\"primary\" />\n        DNS ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æ\n      </Typography>\n\n      <Typography variant=\"subtitle1\" color=\"text.secondary\" sx={{ mb: 4 }}>\n        é«˜åº¦ãªè„…å¨æ¤œå‡ºãƒ»åˆ†æã«ã‚ˆã‚‹DNSã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–\n      </Typography>\n\n      {/* åˆ†æè¨­å®š */}\n      <Card sx={{ mb: 4 }}>\n        <CardContent>\n          <Typography variant=\"h6\" gutterBottom>\n            åˆ†æè¨­å®š\n          </Typography>\n\n          <Grid container spacing={3}>\n            <Grid item xs={12} md={6}>\n              <TextField\n                label=\"ãƒ‰ãƒ¡ã‚¤ãƒ³\"\n                value={domains}\n                onChange={(e) => setDomains(e.target.value)}\n                fullWidth\n                multiline\n                rows={3}\n                placeholder=\"example.com\\nsuspicious.com\\nmalicious.com\"\n                helperText=\"åˆ†æå¯¾è±¡ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°è¡Œå¯ï¼‰\"\n              />\n            </Grid>\n\n            <Grid item xs={12} md={6}>\n              <Grid container spacing={2}>\n                <Grid item xs={12}>\n                  <FormControl fullWidth>\n                    <InputLabel>é‡è¦åº¦ãƒ•ã‚£ãƒ«ã‚¿</InputLabel>\n                    <Select\n                      value={severityFilter}\n                      onChange={(e) => setSeverityFilter(e.target.value)}\n                    >\n                      <MenuItem value=\"all\">ã™ã¹ã¦</MenuItem>\n                      <MenuItem value=\"critical\">é‡è¦</MenuItem>\n                      <MenuItem value=\"high\">é«˜</MenuItem>\n                      <MenuItem value=\"medium\">ä¸­</MenuItem>\n                      <MenuItem value=\"low\">ä½</MenuItem>\n                    </Select>\n                  </FormControl>\n                </Grid>\n                \n                <Grid item xs={12}>\n                  <FormControl fullWidth>\n                    <InputLabel>è„…å¨ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿</InputLabel>\n                    <Select\n                      value={typeFilter}\n                      onChange={(e) => setTypeFilter(e.target.value)}\n                    >\n                      <MenuItem value=\"all\">ã™ã¹ã¦</MenuItem>\n                      <MenuItem value=\"malware\">ãƒãƒ«ã‚¦ã‚§ã‚¢</MenuItem>\n                      <MenuItem value=\"phishing\">ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°</MenuItem>\n                      <MenuItem value=\"typosquatting\">ã‚¿ã‚¤ãƒã‚¹ã‚¯ãƒ¯ãƒƒãƒ†ã‚£ãƒ³ã‚°</MenuItem>\n                      <MenuItem value=\"dga\">DGA</MenuItem>\n                      <MenuItem value=\"fastflux\">Fast Flux</MenuItem>\n                      <MenuItem value=\"dns_hijacking\">DNS ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯</MenuItem>\n                      <MenuItem value=\"cache_poisoning\">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°</MenuItem>\n                      <MenuItem value=\"subdomain_takeover\">ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ä¹—ã£å–ã‚Š</MenuItem>\n                    </Select>\n                  </FormControl>\n                </Grid>\n              </Grid>\n            </Grid>\n          </Grid>\n\n          <Box sx={{ mt: 3, display: 'flex', gap: 2, alignItems: 'center' }}>\n            <Button\n              variant=\"contained\"\n              onClick={runSecurityAnalysis}\n              disabled={loading}\n              startIcon={loading ? <CircularProgress size={20} /> : <PlayArrowIcon />}\n            >\n              {loading ? 'åˆ†æä¸­...' : 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æé–‹å§‹'}\n            </Button>\n            \n            <FormControlLabel\n              control={\n                <Switch\n                  checked={realTimeMonitoring}\n                  onChange={toggleRealTimeMonitoring}\n                  disabled={loading}\n                />\n              }\n              label=\"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–\"\n            />\n            \n            <TextField\n              label=\"ä¿¡é ¼åº¦é–¾å€¤\"\n              type=\"number\"\n              value={confidenceThreshold}\n              onChange={(e) => setConfidenceThreshold(parseInt(e.target.value))}\n              inputProps={{ min: 0, max: 100 }}\n              sx={{ width: 150 }}\n            />\n          </Box>\n        </CardContent>\n      </Card>\n\n      {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}\n      {error && (\n        <Alert severity=\"error\" sx={{ mb: 4 }} onClose={() => setError(null)}>\n          {error}\n        </Alert>\n      )}\n\n      {/* åˆ†æçµæœ */}\n      {analysisResults && (\n        <>\n          {/* çµ±è¨ˆæƒ…å ± */}\n          {renderThreatStatistics()}\n\n          {/* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}\n          <Paper sx={{ mb: 3 }}>\n            <Tabs value={activeTab} onChange={(e, newValue) => setActiveTab(newValue)}>\n              <Tab icon={<ReportIcon />} label=\"è„…å¨ãƒ¬ãƒãƒ¼ãƒˆ\" />\n              <Tab icon={<TimelineIcon />} label=\"åˆ†æçµ±è¨ˆ\" />\n              <Tab icon={<DashboardIcon />} label=\"ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰\" />\n            </Tabs>\n          </Paper>\n\n          {/* è„…å¨ãƒ¬ãƒãƒ¼ãƒˆ */}\n          {activeTab === 0 && (\n            <Card>\n              <CardContent>\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n                  <Typography variant=\"h6\">\n                    è„…å¨æ¤œå‡ºçµæœ ({filteredThreats.length}ä»¶)\n                  </Typography>\n                  <Box>\n                    <IconButton onClick={runSecurityAnalysis} disabled={loading}>\n                      <RefreshIcon />\n                    </IconButton>\n                    <IconButton>\n                      <DownloadIcon />\n                    </IconButton>\n                  </Box>\n                </Box>\n\n                {filteredThreats.length === 0 ? (\n                  <Alert severity=\"success\">\n                    âœ… æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã§è„…å¨ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ\n                  </Alert>\n                ) : (\n                  filteredThreats.map((threat) => (\n                    <Accordion key={threat.id} sx={{ mb: 2 }}>\n                      <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, width: '100%' }}>\n                          <Avatar sx={{ bgcolor: `${getSeverityColor(threat.severity)}.main` }}>\n                            {getThreatIcon(threat.type)}\n                          </Avatar>\n                          \n                          <Box sx={{ flex: 1 }}>\n                            <Typography variant=\"h6\">\n                              {threat.domain}\n                            </Typography>\n                            <Typography variant=\"body2\" color=\"text.secondary\">\n                              {threat.description}\n                            </Typography>\n                          </Box>\n                          \n                          <Box sx={{ display: 'flex', gap: 1 }}>\n                            <Chip\n                              label={threat.severity.toUpperCase()}\n                              color={getSeverityColor(threat.severity) as any}\n                              size=\"small\"\n                            />\n                            <Chip\n                              label={`${threat.confidence}%`}\n                              variant=\"outlined\"\n                              size=\"small\"\n                            />\n                          </Box>\n                        </Box>\n                      </AccordionSummary>\n                      \n                      <AccordionDetails>\n                        <Grid container spacing={3}>\n                          <Grid item xs={12} md={6}>\n                            <Typography variant=\"subtitle2\" gutterBottom>\n                              ğŸ” è„…å¨æŒ‡æ¨™\n                            </Typography>\n                            \n                            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 1 }}>\n                              æŠ€è¡“çš„æŒ‡æ¨™:\n                            </Typography>\n                            <List dense>\n                              {threat.indicators.technicalIndicators.map((indicator, index) => (\n                                <ListItem key={index}>\n                                  <ListItemText primary={`â€¢ ${indicator}`} />\n                                </ListItem>\n                              ))}\n                            </List>\n                            \n                            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 1 }}>\n                              è¡Œå‹•çš„æŒ‡æ¨™:\n                            </Typography>\n                            <List dense>\n                              {threat.indicators.behavioralIndicators.map((indicator, index) => (\n                                <ListItem key={index}>\n                                  <ListItemText primary={`â€¢ ${indicator}`} />\n                                </ListItem>\n                              ))}\n                            </List>\n                          </Grid>\n                          \n                          <Grid item xs={12} md={6}>\n                            <Typography variant=\"subtitle2\" gutterBottom>\n                              ğŸ›¡ï¸ å¯¾ç­–\n                            </Typography>\n                            \n                            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 1 }}>\n                              å³åº§ã®å¯¾ç­–:\n                            </Typography>\n                            <List dense>\n                              {threat.mitigation.immediateActions.map((action, index) => (\n                                <ListItem key={index}>\n                                  <ListItemText primary={`â€¢ ${action}`} />\n                                </ListItem>\n                              ))}\n                            </List>\n                            \n                            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 1 }}>\n                              é•·æœŸçš„å¯¾ç­–:\n                            </Typography>\n                            <List dense>\n                              {threat.mitigation.longTermActions.map((action, index) => (\n                                <ListItem key={index}>\n                                  <ListItemText primary={`â€¢ ${action}`} />\n                                </ListItem>\n                              ))}\n                            </List>\n                          </Grid>\n                          \n                          <Grid item xs={12}>\n                            <Typography variant=\"subtitle2\" gutterBottom>\n                              ğŸ“Š ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†æ\n                            </Typography>\n                            \n                            <Grid container spacing={2}>\n                              <Grid item xs={6} md={3}>\n                                <Paper sx={{ p: 2, textAlign: 'center' }}>\n                                  <Typography variant=\"h6\" color=\"primary\">\n                                    {threat.evidence.networkAnalysis.ipReputationScore}\n                                  </Typography>\n                                  <Typography variant=\"body2\" color=\"text.secondary\">\n                                    IP ãƒ¬ãƒ”ãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³\n                                  </Typography>\n                                </Paper>\n                              </Grid>\n                              \n                              <Grid item xs={6} md={3}>\n                                <Paper sx={{ p: 2, textAlign: 'center' }}>\n                                  <Typography variant=\"h6\" color=\"warning\">\n                                    {threat.evidence.networkAnalysis.geoLocationRisk}\n                                  </Typography>\n                                  <Typography variant=\"body2\" color=\"text.secondary\">\n                                    åœ°ç†çš„ãƒªã‚¹ã‚¯\n                                  </Typography>\n                                </Paper>\n                              </Grid>\n                              \n                              <Grid item xs={6} md={3}>\n                                <Paper sx={{ p: 2, textAlign: 'center' }}>\n                                  <Typography variant=\"h6\" color=\"info\">\n                                    {threat.evidence.networkAnalysis.domainAge}\n                                  </Typography>\n                                  <Typography variant=\"body2\" color=\"text.secondary\">\n                                    ãƒ‰ãƒ¡ã‚¤ãƒ³å¹´æ•°\n                                  </Typography>\n                                </Paper>\n                              </Grid>\n                              \n                              <Grid item xs={6} md={3}>\n                                <Paper sx={{ p: 2, textAlign: 'center' }}>\n                                  <Typography variant=\"h6\" color=\"error\">\n                                    {threat.evidence.networkAnalysis.certificateStatus}\n                                  </Typography>\n                                  <Typography variant=\"body2\" color=\"text.secondary\">\n                                    è¨¼æ˜æ›¸çŠ¶æ…‹\n                                  </Typography>\n                                </Paper>\n                              </Grid>\n                            </Grid>\n                          </Grid>\n                          \n                          <Grid item xs={12}>\n                            <Box sx={{ display: 'flex', gap: 2, justifyContent: 'flex-end' }}>\n                              <Button\n                                variant=\"outlined\"\n                                onClick={() => setSelectedThreat(threat)}\n                                startIcon={<VisibilityIcon />}\n                              >\n                                è©³ç´°ã‚’è¦‹ã‚‹\n                              </Button>\n                              \n                              <Button\n                                variant=\"contained\"\n                                color=\"warning\"\n                                startIcon={<ShieldIcon />}\n                              >\n                                å¯¾ç­–ã‚’å®Ÿè¡Œ\n                              </Button>\n                            </Box>\n                          </Grid>\n                        </Grid>\n                      </AccordionDetails>\n                    </Accordion>\n                  ))\n                )}\n              </CardContent>\n            </Card>\n          )}\n\n          {/* åˆ†æçµ±è¨ˆ */}\n          {activeTab === 1 && (\n            <Card>\n              <CardContent>\n                <Typography variant=\"h6\" gutterBottom>\n                  åˆ†æçµ±è¨ˆ\n                </Typography>\n                \n                <Grid container spacing={3}>\n                  <Grid item xs={12} md={6}>\n                    <Typography variant=\"subtitle2\" gutterBottom>\n                      è„…å¨ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ\n                    </Typography>\n                    {Object.entries(analysisResults.statistics.threatsByType).map(([type, count]) => (\n                      <Box key={type} sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                          {getThreatIcon(type)}\n                          <Typography variant=\"body2\">{type}</Typography>\n                        </Box>\n                        <Typography variant=\"body2\" color=\"text.secondary\">{count}ä»¶</Typography>\n                      </Box>\n                    ))}\n                  </Grid>\n                  \n                  <Grid item xs={12} md={6}>\n                    <Typography variant=\"subtitle2\" gutterBottom>\n                      é‡è¦åº¦åˆ¥åˆ†å¸ƒ\n                    </Typography>\n                    {Object.entries(analysisResults.statistics.threatsBySeverity).map(([severity, count]) => (\n                      <Box key={severity} sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>\n                        <Chip\n                          label={severity.toUpperCase()}\n                          color={getSeverityColor(severity) as any}\n                          size=\"small\"\n                        />\n                        <Typography variant=\"body2\" color=\"text.secondary\">{count}ä»¶</Typography>\n                      </Box>\n                    ))}\n                  </Grid>\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */}\n          {activeTab === 2 && (\n            <Card>\n              <CardContent>\n                <Typography variant=\"h6\" gutterBottom>\n                  ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰\n                </Typography>\n                \n                <Alert severity={realTimeMonitoring ? 'success' : 'info'} sx={{ mb: 3 }}>\n                  {realTimeMonitoring ? 'ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãŒæœ‰åŠ¹ã§ã™' : 'â¸ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã¯ç„¡åŠ¹ã§ã™'}\n                </Alert>\n                \n                <Grid container spacing={3}>\n                  <Grid item xs={12} md={6}>\n                    <Typography variant=\"subtitle2\" gutterBottom>\n                      ç›£è¦–è¨­å®š\n                    </Typography>\n                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\n                      <FormControlLabel\n                        control={<Switch checked={realTimeMonitoring} onChange={toggleRealTimeMonitoring} />}\n                        label=\"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–\"\n                      />\n                      <TextField\n                        label=\"ç›£è¦–é–“éš”ï¼ˆç§’ï¼‰\"\n                        type=\"number\"\n                        defaultValue={60}\n                        InputProps={{ readOnly: realTimeMonitoring }}\n                        size=\"small\"\n                      />\n                    </Box>\n                  </Grid>\n                  \n                  <Grid item xs={12} md={6}>\n                    <Typography variant=\"subtitle2\" gutterBottom>\n                      æœ€è¿‘ã®æ´»å‹•\n                    </Typography>\n                    <Typography variant=\"body2\" color=\"text.secondary\">\n                      æœ€çµ‚åˆ†æ: {new Date().toLocaleString()}\n                    </Typography>\n                    <Typography variant=\"body2\" color=\"text.secondary\">\n                      æ¤œå‡ºã•ã‚ŒãŸè„…å¨: {filteredThreats.length}ä»¶\n                    </Typography>\n                  </Grid>\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n        </>\n      )}\n\n      {/* è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}\n      <Dialog\n        open={!!selectedThreat}\n        onClose={() => setSelectedThreat(null)}\n        maxWidth=\"md\"\n        fullWidth\n      >\n        <DialogTitle>\n          ğŸš¨ è„…å¨è©³ç´°: {selectedThreat?.domain}\n        </DialogTitle>\n        <DialogContent>\n          {selectedThreat && (\n            <Box sx={{ pt: 2 }}>\n              <Typography variant=\"body1\" sx={{ mb: 3 }}>\n                {selectedThreat.description}\n              </Typography>\n              \n              <Divider sx={{ mb: 2 }} />\n              \n              <Typography variant=\"h6\" gutterBottom>\n                ğŸ” å…¨æŒ‡æ¨™\n              </Typography>\n              \n              <Typography variant=\"subtitle2\" gutterBottom>\n                ãƒ¬ãƒ”ãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æŒ‡æ¨™:\n              </Typography>\n              <List dense>\n                {selectedThreat.indicators.reputationIndicators.map((indicator, index) => (\n                  <ListItem key={index}>\n                    <ListItemText primary={`â€¢ ${indicator}`} />\n                  </ListItem>\n                ))}\n              </List>\n              \n              <Typography variant=\"subtitle2\" gutterBottom>\n                äºˆé˜²ç­–:\n              </Typography>\n              <List dense>\n                {selectedThreat.mitigation.preventionMeasures.map((measure, index) => (\n                  <ListItem key={index}>\n                    <ListItemText primary={`â€¢ ${measure}`} />\n                  </ListItem>\n                ))}\n              </List>\n            </Box>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setSelectedThreat(null)}>\n            é–‰ã˜ã‚‹\n          </Button>\n          <Button variant=\"contained\" color=\"warning\">\n            å¯¾ç­–ã‚’å®Ÿè¡Œ\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </Container>\n  );\n};\n\nexport default SecurityAnalysis;"