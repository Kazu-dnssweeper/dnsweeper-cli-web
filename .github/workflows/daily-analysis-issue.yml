name: Daily Analysis Issue Creation

on:
  schedule:
    # æ¯æ—¥åˆå‰9æ™‚ï¼ˆJSTï¼‰ã«å®Ÿè¡Œ
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  create-daily-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        pip install anthropic requests
        
    - name: Run Analysis and Create Issue
      env:
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      uses: actions/github-script@v7
      with:
        script: |
          const { execSync } = require('child_process');
          const fs = require('fs');
          
          // ã‚³ãƒ¼ãƒ‰åˆ†æå®Ÿè¡Œ
          try {
            // ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã¨ã‚µã‚¤ã‚ºã‚’å–å¾—
            const fileCount = execSync('find src -name "*.ts" -o -name "*.js" | wc -l').toString().trim();
            const totalSize = execSync('find src -name "*.ts" -o -name "*.js" -exec wc -c {} + | tail -1').toString().trim();
            
            // æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆæƒ…å ±
            const lastCommit = execSync('git log -1 --format="%h %s %an %ad" --date=short').toString().trim();
            
            // ä»Šæ—¥ã®æ—¥ä»˜
            const today = new Date().toISOString().split('T')[0];
            
            // Issueä½œæˆ
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ“Š Daily Code Analysis - ${today}`,
              body: `## ğŸ” Daily Code Analysis Report
          
          **Date**: ${today}
          **Generated**: ${new Date().toISOString()}
          
          ### ğŸ“ˆ Code Statistics
          - **Total Files**: ${fileCount}
          - **Total Size**: ${totalSize} bytes
          - **Last Commit**: ${lastCommit}
          
          ### ğŸ¯ Analysis Tasks
          Please review the following areas:
          
          - [ ] Check for TypeScript errors
          - [ ] Review ESLint warnings
          - [ ] Verify test coverage
          - [ ] Update documentation if needed
          - [ ] Check for security vulnerabilities
          
          ### ğŸ¤– AI Analysis
          This issue will trigger Claude API analysis for:
          - Code quality assessment
          - Potential improvements
          - Architecture recommendations
          
          **Auto-generated by GitHub Actions**
          
          ---
          
          *This issue is automatically created daily to track code quality and improvements.*`,
              labels: ['analysis', 'daily', 'auto-generated', 'claude-ai']
            });
          } catch (error) {
            console.error('Error creating daily analysis issue:', error);
          }